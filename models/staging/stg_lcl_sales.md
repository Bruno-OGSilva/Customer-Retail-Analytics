# Staging Model: stg_lcl_sales

## Overview
The `stg_lcl_sales` model is designed to extract, clean, and transform raw LCL sales data from the POS system. Data is sourced from the `raw_lcl_sales` table in the `pos` schema. This model performs several key transformations including renaming columns, cleaning currency-formatted values, casting data types, and generating a composite unique identifier. These steps ensure the data is consistent and ready for downstream analytics.

## Source Data
- **Source Table:** `pos.raw_lcl_sales`
- **Raw Columns:**
  - `Site Number`
  - `UPC`
  - `UPC_Description`
  - `Sales`
  - `Units`
  - `Promo Sales`
  - `Promo Units`
  - `Week End Date`
  - `retail_group`

## Transformations Applied
### Column Renaming
- **`Site Number` → store_id:**
  Renamed to serve as the store identifier.
- **`UPC_Description` → product:**
  Provides a descriptive name for the product.
- **`UPC` → upc_no:**
  Retains the original UPC value for reference.

### Data Type Casting & Cleaning
- **UPC Casting:**
  The `UPC` field is cast to an integer to create `upc_int`, enabling numerical operations.
- **Sales Conversion:**
  The `Sales` field is cleaned by removing the `$` symbol and commas, then cast to `float64` as `dollar_sales` to accurately represent monetary values.
- **Units Conversion:**
  The `Units` field is cast to `int64` as `unit_sales` to standardize unit counts.
- **Promotional Sales & Units:**
  The `Promo Sales` field undergoes similar cleaning (removal of `$` and commas) and is cast to `float64` as `promo_dollar_sales`.
  The `Promo Units` field is cast to `int64` as `promo_unit_sales`.
- **Date Conversion:**
  The `Week End Date` field is cast to a DATE type as `week_end_date`, ensuring proper time-series analysis.

### Derived Field
- **unique_store_id:**
  A composite unique identifier is generated by concatenating `retail_group` and `Site Number` with a pipe (`|`) separator. This field is crucial for ensuring each store record is uniquely identifiable for downstream joins and aggregations.

## Business Logic & Rationale
- **Data Consistency:**
  Cleaning currency fields and converting them to numeric types ensures accurate financial calculations.
- **Data Integrity:**
  The renaming of columns and creation of `unique_store_id` enhances clarity and ensures that each record can be reliably joined with other datasets.
- **Foundation for Analysis:**
  These transformations standardize the data, laying a solid foundation for subsequent analytics and reporting.

## Dependencies & Testing Considerations
- **Source Dependency:**
  This model relies on the raw data provided by the `pos.raw_lcl_sales` table. Any changes to the source schema must be updated here.
- **Testing Recommendations:**
  - **Not Null Tests:** Ensure that key fields (e.g., `store_id`, `product`, `upc_no`, `dollar_sales`, `unit_sales`, `week_end_date`, and `unique_store_id`) are not null.
  - **Data Type Verification:** Confirm that fields such as `upc_int`, `dollar_sales`, `unit_sales`, `promo_dollar_sales`, and `promo_unit_sales` are correctly cast to their intended numeric types.
  - **Uniqueness Test:** Validate that `unique_store_id` is unique across all stores to prevent duplicate entries.

## Conclusion
The `stg_lcl_sales` model effectively transforms raw LCL sales data into a structured and analyzable format. By cleaning currency values, standardizing data types, and generating unique identifiers, this model ensures that the data is accurate and ready for reliable downstream analytics and business intelligence.
